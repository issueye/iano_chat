# IANO Chat 项目修改计划

> 创建日期: 2026-02-16
> 版本: v1.0

---

## 一、项目概述

### 1.1 技术栈

| 层级 | 技术 |
|------|------|
| 后端 | Go + GORM + 自定义 Web 框架 |
| 前端 Admin | Vue 3 + Vite + TailwindCSS 4 + Reka UI |
| 前端 Chat | Vue 3 + Wails (桌面应用) + Element Plus X |
| 数据库 | SQLite (默认) |

### 1.2 当前状态

- 后端完成度: ~90%
- 前端 Admin 完成度: ~85%
- 前端 Chat 完成度: ~75%

---

## 二、问题清单

### 2.1 严重问题 (P0)

| # | 问题 | 位置 | 描述 |
|---|------|------|------|
| S1 | API Key 安全风险 | `backend/iano_server/services/provider_service.go` | `GetAll()` 返回明文 API Key，前端直接显示 |
| S2 | 聊天逻辑缺陷 | `backend/iano_server/controllers/chat_controller.go:225-226` | Agent 已绑定后调用 `WaitForResponse()` 但无消息，无法继续对话 |

### 2.2 中等问题 (P1)

| # | 问题 | 位置 | 描述 |
|---|------|------|------|
| M1 | Session Config 空值覆盖 | `backend/iano_server/controllers/session_controller.go` | 空对象会覆盖数据库原有配置 |
| M2 | 目录选择未实现 | `frontend_chat/frontend/src/components/ChatContainer.vue` | `handleSelectDirectory` 仅打印日志 |
| M3 | Dashboard 状态硬编码 | `frontend_admin/src/views/dashboard/index.vue` | 系统状态始终显示"正常" |
| M4 | Provider 状态硬编码 | `frontend_admin/src/views/providers/index.vue` | 状态硬编码为"正常" |
| M5 | 缺少用户认证 | 所有 API | 无权限控制，Authorization 定义未使用 |

### 2.3 次要问题 (P2)

| # | 问题 | 位置 | 描述 |
|---|------|------|------|
| L1 | Agent 重载功能未实现 | `frontend_admin/src/views/agents/index.vue` | 调用 `reload()` 但后端无接口 |
| L2 | 消息反馈 UI 缺失 | 前端 | 后端有 API，前端无入口 |
| L3 | 工具调用结果未展示 | `frontend_chat` | 后端支持但前端无可视化 |

---

## 三、修改计划

### 阶段 1: 修复严重问题 (P0)

**目标**: 修复阻断性 bug

| 任务 | 描述 | 负责人 | 预估工时 |
|------|------|--------|----------|
| 1.1 | Provider API Key 脱敏处理 | - | 1h |
| 1.2 | 前端隐藏 API Key 显示 | - | 0.5h |
| 1.3 | 修复聊天继续对话逻辑 | - | 2h |
| 1.4 | 修复 Session Config 空值覆盖 | - | 1h |

**阶段目标**: 核心聊天功能可用，无安全风险

---

### 阶段 2: 目录选择功能 (P1)

**目标**: 实现工作目录选择并传递给后端

| 任务 | 描述 | 负责人 | 预估工时 |
|------|------|--------|----------|
| 2.1 | Wails 目录选择 API | - | 2h |
| 2.2 | 前端集成目录选择 | - | 1h |
| 2.3 | 后端接收并使用 work_dir | - | 1h |

---

### 阶段 3: Dashboard 和状态显示 (P1)

**目标**: 显示真实系统状态

| 任务 | 描述 | 负责人 | 预估工时 |
|------|------|--------|----------|
| 3.1 | 添加健康检查接口 | - | 0.5h |
| 3.2 | Dashboard 动态状态 | - | 1h |
| 3.3 | Provider 连接测试 | - | 1h |

---

### 阶段 4: 用户认证 (P1)

**目标**: 添加基础认证功能

| 任务 | 描述 | 负责人 | 预估工时 |
|------|------|--------|----------|
| 4.1 | 用户模型和数据库表 | - | 1h |
| 4.2 | 登录/登出 API | - | 2h |
| 4.3 | 前端登录页面 | - | 2h |
| 4.4 | JWT 中间件 | - | 1h |
| 4.5 | 保护 API 路由 | - | 1h |

---

### 阶段 5: 工具调用结果展示 (P2)

**目标**: 可视化工具调用过程

| 任务 | 描述 | 负责人 | 预估工时 |
|------|------|--------|----------|
| 5.1 | SSE 事件类型扩展 | - | 1h |
| 5.2 | 前端工具调用组件 | - | 3h |
| 5.3 | 消息反馈 UI | - | 2h |

---

### 阶段 6: 其他优化 (P2)

**目标**: 完善细节功能

| 任务 | 描述 | 负责人 | 预估工时 |
|------|------|--------|----------|
| 6.1 | Agent 重载接口 | - | 1h |
| 6.2 | MCP 服务器连接状态 | - | 1h |
| 6.3 | 会话历史摘要 | - | 2h |

---

## 四、验收标准

### 阶段 1 验收

- [ ] API Key 不在前端明文显示
- [ ] 可以连续发送多条消息
- [ ] Session Config 更新不会丢失原有数据

### 阶段 2 验收

- [ ] 可以选择工作目录
- [ ] 目录路径传递给后端
- [ ] Agent 可以读取目录内文件

### 阶段 3 验收

- [ ] Dashboard 显示真实系统状态
- [ ] Provider 显示真实连接状态

### 阶段 4 验收

- [ ] 用户可以注册/登录
- [ ] 未登录无法访问 API
- [ ] Token 过期需要重新登录

### 阶段 5 验收

- [ ] 工具调用时显示 loading
- [ ] 工具结果正确展示
- [ ] 可以对消息点赞/点踩

### 阶段 6 验收

- [ ] Agent 可以重载
- [ ] MCP 服务器状态实时更新

---

## 五、风险与依赖

### 风险

1. Wails 桌面端目录选择需要原生支持
2. 用户认证涉及密码加密，需要安全存储
3. 现有代码耦合度较高，修改可能影响现有功能

### 依赖

- 需要有效的 LLM API Key 测试聊天功能
- 需要测试 MCP 服务器连接

---

## 六、版本历史

| 版本 | 日期 | 修改内容 |
|------|------|----------|
| v1.0 | 2026-02-16 | 初始版本 |
